#!/usr/bin/env bash

cleanup() {
  echo "caught Signal ... stopping application ..."

  killall -HUP node
  rm -rf /sockets/pds.sock

  echo "done."
  exit 0
}

trap cleanup HUP

if [[ -z "$@" ]]; then
  rm -rf /sockets/pds.sock

  yarn --cwd /build startp
  exit $?

elif [[ "$@" == "test" ]]; then
  yarn --cwd /build test
  exit $?
fi

exec "$@"
